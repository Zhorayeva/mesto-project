(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{X:()=>M});var t=document.querySelector("#image-popup"),n=document.querySelector(".popup__image"),r=document.querySelector(".popup__image_title"),o=document.querySelectorAll(".popup__close");function u(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",a),e.removeEventListener("mousedown",i)}function c(e){e.classList.add("popup_opened"),document.addEventListener("keydown",a),e.addEventListener("mousedown",i)}var i=function(e){e.target===e.currentTarget&&u(e.target)},a=function(e){"Escape"===e.key&&u(document.querySelector(".popup_opened"))},l={url:"https://mesto.nomoreparties.co/v1/plus-cohort-14",headers:{authorization:"0dcfa538-92a2-4afe-989e-66160705b266","content-type":"application/json"},myId:""},s=function(e){return e.then((function(e){return e.ok?e.json():Promise.reject("something wrong: ".concat(e.statusText))})).catch((function(e){console.log(e)}))},d=document.querySelector(".profile__edit-button"),m=document.querySelector("#profile-form"),p=document.querySelector("#profile-popup"),f=document.querySelector(".profile__name"),_=document.querySelector(".profile__description"),v=document.querySelector(".popup__input_info_name"),y=document.querySelector(".popup__input_info_description"),h=document.querySelector(".profile__avatar-button"),b=document.querySelector(".profile__avatar"),S=document.querySelector("#avatar-change"),q=document.querySelector("#avatar-form"),E=document.querySelector("#avatar-input");function g(e){u(e.target.closest(".popup"))}function L(e,o){var u,i,a,l,s,d;e.prepend((u=o,i=I.querySelector(".element").cloneNode(!0),a=i.querySelector(".element__image"),l=i.querySelector(".element__remove"),s=i.querySelector(".element__like-counter"),d=i.querySelector(".element__like"),a.src=u.link,a.alt=u.name,a.id=u._id,a.addEventListener("click",(function(){var e,o;e=u.name,o=u.link,n.src=o,n.alt=e,r.textContent=e,c(t)})),i.querySelector(".element__title").textContent=u.name,d.addEventListener("click",k),s.textContent=u.likes.length,u.likes.forEach((function(e){A(e._id)&&d.classList.add("element__like-active")})),A(u.owner._id)?l.addEventListener("click",C):l.remove(),i))}function k(e){var t,n=e.target,r=n.closest(".element"),o=r.querySelector(".element__image"),u=r.querySelector(".element__like-counter");n.classList.contains("element__like-active")?(t=o.id,s(fetch("".concat(l.url,"/cards/likes/").concat(t),{method:"DELETE",headers:l.headers}))).then((function(e){u.textContent=e.likes.length})):function(e){return s(fetch("".concat(l.url,"/cards/likes/").concat(e),{method:"PUT",headers:l.headers}))}(o.id).then((function(e){u.textContent=e.likes.length})),n.classList.toggle("element__like-active")}function C(e){var t,n=e.target.closest(".element"),r=n.querySelector(".element__image");n.remove(),t=r.id,s(fetch("".concat(l.url,"/cards/").concat(t),{method:"DELETE",headers:l.headers}))}var x,A=function(e){return l.myId===e},D=function(e,t){e.textContent=t?"Сохранение...":"Сохранить"},w=document.querySelector("#article-form"),T=document.querySelector("#article-popup"),O=document.querySelector(".profile__add-button"),P=document.querySelector(".popup__input_image_name"),j=document.querySelector(".popup__input_image_link"),N=document.querySelector(".elements"),I=document.querySelector("#article").content,J=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.buttonSubmitDisabled),t.removeAttribute("disabled")):(t.classList.add(n.buttonSubmitDisabled),t.setAttribute("disabled",!0))};d.addEventListener("click",(function(){var e;(e=p).querySelectorAll(".popup__input").forEach((function(e){return e.classList.remove("popup__input_type_error")})),e.querySelectorAll(".popup__input-error").forEach((function(e){return e.textContent=""})),v.value=f.textContent,y.value=_.textContent,c(p)})),o.forEach((function(e){return e.addEventListener("click",g)})),m.addEventListener("submit",(function(e){var t,n;e.preventDefault(),D(e.submitter,!0),(t=v.value,n=y.value,s(fetch("".concat(l.url,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:t,about:n})}))).then((function(e){f.textContent=e.name,_.textContent=e.about})).finally((function(){D(e.submitter,!1)})),u(p)})),O.addEventListener("click",(function(){c(T)})),w.addEventListener("submit",(function(e){var t,n;e.preventDefault(),D(e.submitter,!0),(t=P.value,n=j.value,s(fetch("".concat(l.url,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:t,link:n})}))).then((function(e){L(N,e.name,e.link,e._id,e.owner)})).finally((function(){D(e.submitter,!1)})),u(T),e.target.reset(),e.submitter.setAttribute("disabled",!0),e.submitter.classList.add(M.buttonSubmitDisabled)})),h.addEventListener("click",(function(e){c(S)})),q.addEventListener("submit",(function(e){var t;e.preventDefault(),D(e.submitter,!0),(t=E.value,s(fetch("".concat(l.url,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:t})}))).then((function(e){b.src=e.avatar})).finally((function(){D(e.submitter,!1)})),u(S)})),x=N,s(fetch("".concat(l.url,"/cards"),{headers:l.headers})).then((function(e){e.reverse().forEach((function(e){return L(x,e)}))})),s(fetch("".concat(l.url,"/users/me"),{headers:l.headers})).then((function(e){b.src=e.avatar,f.textContent=e.name,_.textContent=e.about,l.myId=e._id,f.id=e._id}));var M={formClass:".popup__form",inputClass:".popup__input",buttonSubmit:".popup__submit",buttonSubmitDisabled:"popup__submit_disabled",inputErrorClass:"popup__input_type_error"};!function(e){Array.from(document.querySelectorAll(e.formClass)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputClass)),r=e.querySelector(t.buttonSubmit);J(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n}(e,t,t.validationMessage,n)}(e,o,t),J(n,r,t)}))}))}(t,e)}))}(M)})();